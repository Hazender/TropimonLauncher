<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- Permissions de base - Celles-ci sont considérées comme normales et ne posent pas de problème. -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.VIBRATE"/>

    <!-- Permissions pour les services de premier plan et les notifications (obligatoire depuis Android 13) -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

    <!--
    Permissions pour le chat vocal (optionnel).
    -->
    <uses-permission android:name="android.permission.RECORD_AUDIO"/>
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_MICROPHONE" />
    <uses-feature android:name="android.hardware.microphone" android:required="false" />

    <!--
    NOTE IMPORTANTE : Toutes les permissions de stockage dangereuses ont été supprimées.
    L'application utilisera son stockage interne spécifique, qui ne nécessite aucune permission.
    -->

    <application
        android:name="TLApplication"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:networkSecurityConfig="@xml/network_security_config"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="${launcher_name}"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:theme="@style/AppTheme.ZalithLauncher"
        android:appCategory="game"
        android:process=":launcher"
        android:supportsRtl="true"
        android:isGame="true"
        android:allowBackup="true"
        android:hasFragileUserData="true"
        android:resizeableActivity="true"
        android:allowNativeHeapPointerTagging="false"
        tools:targetApi="31"
        tools:ignore="DiscouragedApi">
        <!-- L'attribut 'requestLegacyExternalStorage' a été supprimé car il est obsolète et contradictoire. -->

        <activity
            android:name=".ui.activities.SplashActivity"
            android:theme="@style/AppTheme.SplashScreen"
            android:exported="true"
            android:windowSoftInputMode="adjustResize"
            android:configChanges="keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|keyboard|navigation"
            android:screenOrientation="sensorLandscape">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <!-- ... autres activités ... -->
        <activity
            android:name=".ui.activities.MainActivity"
            android:configChanges="keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|keyboard|navigation"
            android:screenOrientation="sensorLandscape" />
        <activity
            android:name=".ui.activities.ControlEditorActivity"
            android:configChanges="keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|keyboard|navigation"
            android:screenOrientation="sensorLandscape" />
        <activity
            android:name=".ui.activities.VMActivity"
            android:alwaysRetainTaskState="true"
            android:configChanges="keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|keyboard|navigation"
            android:launchMode="singleTop"
            android:process=":game"
            android:screenOrientation="sensorLandscape" />
        <activity android:name=".ui.activities.ErrorActivity"
            android:configChanges="keyboardHidden|orientation|screenSize|smallestScreenSize|screenLayout|keyboard|navigation"
            android:screenOrientation="sensor" />
        <activity android:name=".ui.activities.FatalErrorActivity"
            android:configChanges="keyboardHidden|orientation|screenSize|keyboard|navigation"
            android:theme="@style/Theme.Material3.DayNight.Dialog.Alert" />

        <service
            android:name=".game.download.jvm_server.JvmService"
            android:enabled="true"
            android:foregroundServiceType="dataSync|microphone"
            android:process=":jvm" />

        <!--
        CORRECTION : Ce 'Provider' est ESSENTIEL pour l'import/export.
        Il permet à d'autres applications (comme les explorateurs de fichiers)
        d'interagir avec le dossier de jeu de votre application de manière sécurisée,
        via le Storage Access Framework, sans nécessiter de permission de stockage.
        L'attribut 'exported' doit être 'true' pour que cela fonctionne.
        -->
        <provider
            android:name=".provider.FolderProvider"
            android:authorities="${packageName}.document.provider"
            android:exported="true"
            android:grantUriPermissions="true"
            android:permission="android.permission.MANAGE_DOCUMENTS">
            <intent-filter>
                <action android:name="android.content.action.DOCUMENTS_PROVIDER" />
            </intent-filter>
        </provider>

        <!--
        Ce 'FileProvider' est utilisé pour partager des fichiers spécifiques
        de manière sécurisée (par exemple, un fichier de log pour un rapport de bug).
        Il doit rester non exporté.
        -->
        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${packageName}.provider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/provider_paths" />
        </provider>

    </application>

    <queries>
        <package android:name="net.kdt.pojavlaunch.ffmpeg"/>
        <intent>
            <action android:name="android.intent.action.MAIN" />
        </intent>
    </queries>
</manifest>
